# 2025 OOPL Final Report

## 組別資訊

組別：33
組員：廖威昌
復刻遊戲：dino shift

## 專案簡介

### 遊戲簡介
Dino Shift 是一款結合「變色」與「平台跳躍」的益智動作遊戲。玩家操作的小恐龍可在紅 / 綠 / 藍三種顏色間切換；只有在顏色不同的方塊上才能站立，顏色相同時方塊會消失。每關需蒐集指定數量的色塊並安全抵達出口
### 組別分工
‣ 核心遊戲邏輯

‣ 關卡設計與調校

‣ 地圖設計與調校

‣ 報告撰寫、投影片製作

## 遊戲介紹

### 遊戲規則
初始畫面按enter進入遊戲

1.角色可按 Z / X / C 切換紅、綠、藍三色。

2.角色只能站在「顏色不同」的彩色方塊或任何普通平台上。

3.與角色同色的彩色方塊會瞬間消失，掉落即失敗並重生至檢查點。

4.收集完 關卡指定數量 的方塊後，開啟出口門並通關。

5.生命無限制。

6.按Ｒ可以重新開始

外掛

1.按空白鍵會直接進入下一關

2.Ｑ退出遊戲

3.按下左Shift 角色可以加速

### 遊戲畫面
![alt text](<截圖 2025-06-11 上午10.14.49.png>)
![alt text](<截圖 2025-06-11 上午10.15.02.png>)
![alt text](<截圖 2025-06-11 上午10.15.16.png>)

## 程式設計

### 程式架構
PTSD-dino-shift/

├─ **include/**            *C++ headers*  
│   ├─ **App.hpp**               ── Application 入口  
│   ├─ **AppUtil.hpp**           ── 共用工具 (碰撞判定等)  
│   ├─ **Character.hpp**         ── 角色基底 (Transform / 影像)  
│   ├─ **Platform.hpp**          ── 靜態 / 移動 / 彩色平台  
│   ├─ **ColorBlock.hpp**        ── 彩色方塊工具 (Row / Column / Moving)  
│   ├─ **Spike.hpp**             ── 地刺 (靜態 / 旋轉)  
│   ├─ **Spring.hpp**            ── 彈簧 (動畫 + 推力)  
│   ├─ **Enemy.hpp**             ── 巡邏敵人 AI  
│   └─ **Phase.hpp** …           ── 流程 / 場景資源管理  
│  
├─ **src/**                 *對應 .cpp 實作*  
│   ├─ AppStart.cpp / AppUpdate.cpp / AppEnd.cpp  
│   ├─ Character.cpp  
│   ├─ Platform.cpp / Spike.cpp / Spring.cpp  
│   ├─ Enemy.cpp  
│   └─ PhaseManager.cpp  
│  
├─ **Resources/**           *圖片*  
│   └─ Image/Character/…  
│  
├─ **PTSD/**                *第三方框架*  
├─ **CMakeLists.txt**       *建置腳本 (自動掃描 include / src)*  
└─ **cmake-build-debug/**   *CLion 產生的 out-of-source build*

### 程式技術

| 技術 | 說明 |
|------|------|
| **Component-based Transform** | 位置／旋轉／縮放統一在 `Transform`，所有物件繼承 `Character` 自帶座標系。 |
| **AABB Collision Manager** | 所有平台、彩色方塊、敵人均使用單一 AABB 分離演算法，並整合顏色機制與移動平台速度，確保碰撞穩定不穿模。 |
| **Moving Block Interpolation** | 彩色方塊與一般平台的往返運動採固定時間步長，端點 `clamp` + 方向翻轉，並在玩家站立時同步平移，避免抖動。 |
| **Enemy AI & Mechanics** | 左右巡邏、端點自動轉向；偵測到玩家碰觸即觸發受傷流程，敵人具死亡機制，並可與玩家同步跳躍。 |
| **Dynamic Color Switching** | 角色紅／綠／藍狀態以位元列表示，切換即時比對平台顏色並觸發方塊隱藏 / 顯示及碰撞啟用 / 關閉。 |
| **State-Machine Animation** | 受傷動畫 (Hurt 1–3) 與彈簧壓縮 (spring 1–3) 皆用 frame state 管理，避免多層 if 造成複雜度。 |
| **Ray-cast + Slope Hitbox** | 地刺等斜角物件採水平 ray-cast 比對像素遮罩，減少卡邊現象。 |
| **Memory-Leak Guard** | `valgrind` + `std::shared_ptr` 檢測，關卡載入 / 卸除後 RSS 穩定，零洩漏。 |

## 結語

### 問題與解決方法 

| 問題 | 解法 |
|------|------|
| **彩色平台消失後玩家掉速過慢** | 受傷動畫播放過久 → 改用固定 0.6 s 並在動畫結束即重生。 |
| **移動平台卡牆** | 轉向時加入 `std::clamp`，保證 x 仍在合法範圍後再反轉速度。 |
| **碰撞閃爍** | AABB 容差從 2 px 提升到 5 px，並只在「首次接觸」觸發彈簧。 |
| **平台碰撞卡牆** | 碰撞問題 角色站立與彈跳 圖片是png所以大小可能有誤差 導致卡牆；已詢問助教，確認屬 PTSD 框架問題，成績不扣分。 |


### 自評

| 項次 | 項目                   | 完成 |
|------|------------------------|-------|
| 1    | 完成專案權限改為 public |   V  |
| 2    | 具有 外掛 功能  |  V   |
| 3    | 解決專案上所有 Memory Leak 的問題  |   V  |
| 4    | 報告中沒有任何錯字，以及沒有任何一項遺漏  |   V  |
| 5    | 報告至少保持基本的美感，人類可讀  |   V  |

### 心得
本次 OOPL 期末專案雖然只有 **一人開發**（另一位組員已休學、零貢獻），卻讓我深刻體會到：「**寫遊戲 = 寫故事 + 修 bug**」，從需求拆分、模組化設計到不停的除錯，每一步都在驗證良好架構的重要性——拆得越乾淨，後續修改就越輕鬆。說實話，這一路很痛苦但也有成就感；若下學期還有類似的大型專案機會，我可能會先三思而後行。

### 貢獻比例

| 成員   | 程式 | 美術 / 資源 | 文檔 / 報告 |
|--------|:---:|:-----------:|:-----------:|
| 廖威昌 | 100% | 100% | 100% | 

